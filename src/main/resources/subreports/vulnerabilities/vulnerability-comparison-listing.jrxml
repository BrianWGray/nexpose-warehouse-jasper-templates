<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.3.1.final using JasperReports Library version 6.3.1  -->
<!-- 2016-11-02T10:24:23 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="vulnerability-comparison-listing" pageWidth="523" pageHeight="842" whenNoDataType="NoDataSection" columnWidth="523" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" whenResourceMissingType="Empty" uuid="a786fdfe-ffc6-438b-b7f5-989b07c781b2">
	<property name="ireport.zoom" value="1.0514816984441795"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="112"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="warehouse"/>
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<import value="java.time.format.*"/>
	<style name="Title" fontSize="50" isBold="true"/>
	<style name="SubTitle" forecolor="#736343" fontSize="18"/>
	<style name="Column header" forecolor="#666666" fontSize="12" isBold="true"/>
	<style name="Detail" fontSize="12"/>
	<style name="Row" mode="Transparent">
		<conditionalStyle>
			<conditionExpression><![CDATA[$V{REPORT_COUNT}%2 == 0]]></conditionExpression>
			<style backcolor="#FFFFFF"/>
		</conditionalStyle>
	</style>
	<parameter name="BASE_DIR" class="java.lang.String" isForPrompting="false">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA["../.."]]></defaultValueExpression>
	</parameter>
	<parameter name="START_DATE" class="java.time.LocalDate">
		<parameterDescription><![CDATA[The start date of the trending for the report.]]></parameterDescription>
		<defaultValueExpression><![CDATA[java.time.LocalDate.now().minusDays(90)]]></defaultValueExpression>
	</parameter>
	<parameter name="END_DATE" class="java.time.LocalDate">
		<parameterDescription><![CDATA[The end date for the trending of the report.]]></parameterDescription>
		<defaultValueExpression><![CDATA[java.time.LocalDate.now()]]></defaultValueExpression>
	</parameter>
	<parameter name="WHERE_FILTER_ASSET" class="java.lang.String">
		<parameterDescription><![CDATA[Clause that can filter assets (asset_id).]]></parameterDescription>
		<defaultValueExpression><![CDATA["true"]]></defaultValueExpression>
	</parameter>
	<parameter name="WHERE_FILTER_VULNERABILITY" class="java.lang.String">
		<parameterDescription><![CDATA[Clause that can filter vulnerabilities (vulnerability_id).]]></parameterDescription>
		<defaultValueExpression><![CDATA["true"]]></defaultValueExpression>
	</parameter>
	<parameter name="ORDER_BY" class="java.lang.String">
		<parameterDescription><![CDATA[ORDER BY clause to sort results.]]></parameterDescription>
		<defaultValueExpression><![CDATA["assets_changed ASC"]]></defaultValueExpression>
	</parameter>
	<parameter name="LIMIT" class="java.lang.Integer">
		<parameterDescription><![CDATA[The number of vulnerabilities to display.]]></parameterDescription>
		<defaultValueExpression><![CDATA[Integer.MAX_VALUE]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT title, COALESCE(b.assets, 0) AS start_assets, COALESCE(a.assets, 0) AS end_assets, COALESCE(a.assets, 0) - COALESCE(b.assets, 0) AS assets_changed
FROM (
   SELECT vulnerability_id, COUNT(DISTINCT asset_id) AS assets
   FROM fact_asset_vulnerability_finding_date
   WHERE day = '$P!{START_DATE}' AND $P!{WHERE_FILTER_ASSET} AND $P!{WHERE_FILTER_VULNERABILITY}
   GROUP BY vulnerability_id
) b FULL OUTER JOIN (
   SELECT vulnerability_id, COUNT(DISTINCT asset_id) AS assets
   FROM fact_asset_vulnerability_finding_date
   WHERE day = '$P!{END_DATE}' AND $P!{WHERE_FILTER_ASSET} AND $P!{WHERE_FILTER_VULNERABILITY}
   GROUP BY vulnerability_id
) a USING (vulnerability_id)
   JOIN dim_vulnerability USING (vulnerability_id)
ORDER BY $P!{ORDER_BY}
LIMIT $P!{LIMIT}]]>
	</queryString>
	<field name="title" class="java.lang.String"/>
	<field name="start_assets" class="java.lang.Long"/>
	<field name="end_assets" class="java.lang.Long"/>
	<field name="assets_changed" class="java.lang.Long"/>
	<variable name="CURRENT_PAGE_NUMBER" class="java.lang.Integer" resetType="None">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[0]]></initialValueExpression>
	</variable>
	<columnHeader>
		<band height="30">
			<textField>
				<reportElement mode="Opaque" x="0" y="0" width="200" height="30" forecolor="#4D4D4F" backcolor="#F0F0F0" uuid="067ef5b5-f542-44b8-a458-f4087e5c8871">
					<property name="net.sf.jasperreports.export.html.id" value="assetheader"/>
				</reportElement>
				<box leftPadding="3" bottomPadding="3"/>
				<textElement verticalAlignment="Bottom" rotation="None" markup="none">
					<font size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Vulnerability"]]></textFieldExpression>
			</textField>
			<image>
				<reportElement mode="Opaque" x="77" y="16" width="12" height="12" backcolor="#F0F0F0" uuid="a1e81599-4711-4641-b1da-3c2205cf7552">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<printWhenExpression><![CDATA[$P{ORDER_BY}.contains("title")]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{BASE_DIR} + "/images/sort-" + ($P{ORDER_BY}.contains("title DESC") ?  "down" : "up") + ".png"]]></imageExpression>
			</image>
			<textField>
				<reportElement mode="Opaque" x="200" y="0" width="240" height="16" forecolor="#4D4D4F" backcolor="#F0F0F0" uuid="6a0c46cc-b434-4e0f-9ae6-6604a5511de0">
					<property name="net.sf.jasperreports.export.html.id" value="assetheader"/>
				</reportElement>
				<box leftPadding="25"/>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" markup="none">
					<font size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Assets Affected"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement mode="Opaque" x="200" y="14" width="120" height="16" forecolor="#4D4D4F" backcolor="#F0F0F0" uuid="3f229525-1a69-4324-9bb0-65ced3f81f45">
					<property name="net.sf.jasperreports.export.html.id" value="assetheader"/>
				</reportElement>
				<box leftPadding="0" rightPadding="14"/>
				<textElement textAlignment="Right" verticalAlignment="Middle" rotation="None" markup="none">
					<font size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateTimeFormatter.ofLocalizedDate(FormatStyle.SHORT).format($P{START_DATE})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement mode="Opaque" x="320" y="14" width="120" height="16" forecolor="#4D4D4F" backcolor="#F0F0F0" uuid="2ff6ea26-2363-415d-97aa-528161964216">
					<property name="net.sf.jasperreports.export.html.id" value="assetheader"/>
				</reportElement>
				<box leftPadding="0" rightPadding="14"/>
				<textElement textAlignment="Right" verticalAlignment="Middle" rotation="None" markup="none">
					<font size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[DateTimeFormatter.ofLocalizedDate(FormatStyle.SHORT).format($P{END_DATE})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement mode="Opaque" x="440" y="0" width="82" height="30" forecolor="#4D4D4F" backcolor="#F0F0F0" uuid="af332074-e98d-45e9-9c2f-a7e7e8e320aa">
					<property name="net.sf.jasperreports.export.html.id" value="assetheader"/>
				</reportElement>
				<box leftPadding="0" bottomPadding="3" rightPadding="16"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom" rotation="None" markup="none">
					<font size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA["Change"]]></textFieldExpression>
			</textField>
			<image>
				<reportElement mode="Opaque" x="508" y="16" width="12" height="12" backcolor="#F0F0F0" uuid="bca1f110-0317-41ba-ba06-41dded8ded2a">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<printWhenExpression><![CDATA[$P{ORDER_BY}.contains("change")]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{BASE_DIR} + "/images/sort-" + ($P{ORDER_BY}.contains("change DESC") ?  "down" : "up") + ".png"]]></imageExpression>
			</image>
			<image>
				<reportElement mode="Opaque" x="306" y="16" width="12" height="12" backcolor="#F0F0F0" uuid="d71e3979-237e-4d47-ab27-6f75300bb731">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<printWhenExpression><![CDATA[$P{ORDER_BY}.contains("start_assets")]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{BASE_DIR} + "/images/sort-" + ($P{ORDER_BY}.contains("start_assets DESC") ?  "down" : "up") + ".png"]]></imageExpression>
			</image>
			<image>
				<reportElement mode="Opaque" x="427" y="16" width="12" height="12" backcolor="#F0F0F0" uuid="9d94f15f-9b5a-4f09-83f0-e084149ce163">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<printWhenExpression><![CDATA[$P{ORDER_BY}.contains("end_assets")]]></printWhenExpression>
				</reportElement>
				<imageExpression><![CDATA[$P{BASE_DIR} + "/images/sort-" + ($P{ORDER_BY}.contains("end_assets DESC") ?  "down" : "up") + ".png"]]></imageExpression>
			</image>
		</band>
	</columnHeader>
	<detail>
		<band height="19">
			<textField isStretchWithOverflow="true">
				<reportElement x="0" y="0" width="200" height="18" forecolor="#000000" uuid="eb76a740-2f43-4e83-bb9c-5787aa8ac897">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<propertyExpression name="net.sf.jasperreports.export.html.id"><![CDATA["assetinfo" + $V{REPORT_COUNT}]]></propertyExpression>
				</reportElement>
				<box topPadding="3" leftPadding="3" bottomPadding="3"/>
				<textElement verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{title}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###">
				<reportElement x="200" y="0" width="120" height="18" forecolor="#000000" uuid="ff9b4338-e74a-4df5-96ab-6c489add7347">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<propertyExpression name="net.sf.jasperreports.export.html.id"><![CDATA["assetinfo" + $V{REPORT_COUNT}]]></propertyExpression>
				</reportElement>
				<box leftPadding="3"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{start_assets}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###">
				<reportElement x="320" y="0" width="120" height="18" forecolor="#000000" uuid="773494a2-5acf-45c4-a129-7aef8ab6ef92">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<propertyExpression name="net.sf.jasperreports.export.html.id"><![CDATA["assetinfo" + $V{REPORT_COUNT}]]></propertyExpression>
				</reportElement>
				<box leftPadding="3"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{end_assets}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###">
				<reportElement x="440" y="0" width="83" height="18" forecolor="#000000" uuid="cc1936c0-9340-4f52-9313-de081e12974e">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<propertyExpression name="net.sf.jasperreports.export.html.id"><![CDATA["assetinfo" + $V{REPORT_COUNT}]]></propertyExpression>
				</reportElement>
				<box leftPadding="0" rightPadding="3"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{assets_changed}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement positionType="Float" x="0" y="18" width="523" height="1" forecolor="#CCCCCC" uuid="06cae7f5-1109-41f0-877b-f3c69a5d9778"/>
				<graphicElement>
					<pen lineWidth="0.25" lineStyle="Solid" lineColor="#CCCCCC"/>
				</graphicElement>
			</line>
		</band>
	</detail>
</jasperReport>
